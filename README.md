# NHTSA 충돌 테스트 데이터 수집

이 프로젝트는 미국 고속도로교통안전국(NHTSA)의 공개 API로부터 차량 충돌 테스트 데이터를 효율적으로 수집하기 위해 설계된 특화된 비동기 ETL(Extract, Transform, Load) 시스템입니다.

이 프로젝트는 두 가지 프로젝트 시스템의 첫 번째 부분입니다:
1.  **`nhtsa-data-collection` (현재 프로젝트):** API로부터 데이터를 가져오고 안정적으로 저장하는 데 중점을 둡니다.
2.  **`pulse-analysis`:** 이 시스템이 수집한 데이터를 분석에 활용하는 별도의 프로젝트입니다.

## 아키텍처 개요

이 아키텍처는 고성능의 비차단 네트워크 I/O 및 엄격한 데이터 무결성을 보장하기 위해 최신 Python 라이브러리(`asyncio`, `httpx`, `pydantic`)를 기반으로 구축되었습니다. 청크 처리 및 지속적인 다운로드 큐와 같은 기능을 통해 대용량 데이터를 처리하고 중단으로부터 유연하게 복구하도록 견고성에 중점을 둡니다.

## 데이터 개요

### 수집하는 데이터
이 프로젝트는 두 종류의 데이터를 수집합니다.
1.  **테스트 메타데이터**: 각 충돌 테스트의 상세 정보입니다.
    -   차량 정보 (제조사, 모델, 연식)
    -   테스트 조건 (충돌 종류, 속도, 각도)
    -   테스트 날짜 및 고유 식별 번호
2.  **RAW 센서 데이터**: 테스트 중 차량에 부착된 센서에서 수집된 시계열(Time-series) 데이터입니다.
    -   주로 차량의 특정 위치에서 시간에 따라 측정된 **가속도 (G)** 데이터가 핵심입니다.

### 데이터 형식
-   **메타데이터**: `data/nhtsa_data.db` 경로의 **SQLite 데이터베이스**에 정형화된 테이블 형태로 저장됩니다.
-   **RAW 데이터**: NI(National Instruments)사의 독점 바이너리 형식인 **TDMS(.tdms)** 파일로 제공됩니다. 이 파일들은 보통 `.zip` 아카이브로 압축되어 있으며, `data/downloads/` 디렉토리 아래에 각 테스트 ID별로 폴더가 생성되어 저장됩니다.

### 무엇을 알 수 있는가?
수집된 데이터를 통해 다음을 분석할 수 있습니다. (실제 분석은 `pulse-analysis` 프로젝트에서 수행됩니다.)
-   **충돌 동역학 분석**: 가속도 데이터를 적분하여 충돌 중 속도 변화(Delta-V)와 변위를 계산하고, 충격이 전달되는 과정을 이해할 수 있습니다.
-   **차량 안전 성능 비교**: 다른 차량 모델이나 연식 간의 충돌 데이터를 비교하여 안전 성능의 차이를 정량적으로 평가할 수 있습니다.
-   **상해 가능성 예측**: 측정된 가속도 값을 기반으로 HIC(두부 상해 기준)와 같은 상해 지수를 계산하여 탑승자의 부상 위험도를 예측할 수 있습니다.

## 사용 방법

### 1. 설치

저장소를 복제하고 필요한 종속성을 설치합니다. 가상 환경을 사용하는 것을 강력히 권장합니다.

```bash
git clone <repository-url>
cd nhtsa-data-collection
python -m venv venv
source venv/bin/activate  # Windows에서는 `venv\Scripts\activate` 사용
pip install -r requirements.txt
```

### 2. 설정

모든 설정은 `config.py` 파일에서 관리됩니다. 다음 설정을 변경할 수 있습니다:
- **`MIN_TEST_NO` / `MAX_TEST_NO`**: 가져올 NHTSA 테스트 ID의 범위.
- **`DB_PATH`**: SQLite 데이터베이스 파일의 위치.
- **`DATA_ROOT`**: 모든 데이터를 저장할 루트 디렉토리.

### 3. 실행

데이터 수집 프로세스는 병렬로 실행될 수 있는 두 단계 프로세스입니다.

**단계 1: 메타데이터 가져오기**

이 스크립트는 API로부터 주요 테스트 정보를 가져와 데이터베이스에 채웁니다. 이미 데이터베이스에 있는 모든 테스트는 자동으로 건너뜁니다.

```bash
python main.py
```

**단계 2: 데이터 파일 다운로드**

이 스크립트는 데이터베이스에 저장된 다운로드 큐를 처리하는 영구 서비스로 실행됩니다. 단계 1에서 가져온 메타데이터와 관련된 원시 데이터 파일(예: TDMS 신호)을 다운로드합니다.

```bash
python download.py
```
이 스크립트는 데이터베이스에서 다운로드할 새 파일을 계속 폴링하며 실행됩니다.

## 프로젝트 구조

```
.
├── .gitignore
├── config.py           # 주요 설정 파일
├── data/
│   └── nhtsa_data.db   # SQLite 데이터베이스 (첫 실행 시 생성)
├── download.py         # 파일 다운로더 서비스의 진입점
├── logs/               # 로그 파일
├── main.py             # 메타데이터 가져오기의 주요 진입점
├── README.md           # 이 파일
├── requirements.txt    # 프로젝트 종속성
└── src/
    ├── api/            # 비동기 API 클라이언트
    ├── core/           # Pydantic 모델 및 데이터 파서
    └── utils/          # 데이터베이스 핸들러 및 기타 유틸리티
```